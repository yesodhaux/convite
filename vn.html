
<!DOCTYPE html>
<html>
<head>
  <title>Enviar Nome com Verificação</title>
</head>
<body>
  <h2>Formulário com Verificação</h2>
  <form id="formNome">
    <label>Nome: <input type="text" id="nome" required></label><br>
    <button type="submit">Enviar</button>
  </form>
  <p id="status"></p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzHFSTdp-bMBVzJZXJd46pw00uoI0bhbPuUSEqRq7wZuJX-EyUKGJP2MGIujNPpBOrA/exec";
    const sheetID = "1rciT4XRsTDWRngs_pZYJH4dVSSjd_knPg1c73NShKjI";
    const apiKey = "AIzaSyDEfv-br2uswAz4-oPK_ZTXFsholEFqoOQ";
    const sheetName = "Página1";

    document.getElementById("formNome").addEventListener("submit", async function(e) {
      e.preventDefault();
      const nome = document.getElementById("nome").value.trim();
      document.getElementById("status").innerText = "Enviando...";

      // Envia o nome via POST para o Apps Script
      const formData = new URLSearchParams();
      formData.append("nome", nome);

      try {
        await fetch(scriptURL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: formData.toString()
        });

        // Espera 1 segundo e depois lê a última linha da planilha
        setTimeout(async () => {
          const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${sheetName}!A:A?key=${apiKey}`;
          const response = await fetch(url);
          const data = await response.json();
          const valores = data.values || [];
          const ultima = valores[valores.length - 1]?.[0] || "";

          if (ultima.toLowerCase() === nome.toLowerCase()) {
            document.getElementById("status").innerText = "✅ Nome adicionado com sucesso!";
          } else {
            document.getElementById("status").innerText = "❌ Falha ao confirmar inserção.";
          }
        }, 1000);
      } catch (err) {
        document.getElementById("status").innerText = "❌ Erro ao enviar.";
        console.error(err);
      }

      document.getElementById("formNome").reset();
    });
  </script>
</body>
</html>
